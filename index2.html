<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mira - AI Interview System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #b3e5fc 50%, #ffffff 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
        }

        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(67, 160, 212, 0.15), 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 50px;
            animation: slideIn 0.5s ease-out;
            border: 1px solid rgba(179, 229, 252, 0.4);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            font-size: 0;
            margin-bottom: 0px;
        }

        h1 {
            background: linear-gradient(135deg, #0277bd 0%, #00897b 25%, #6a1b9a 50%, #d32f2f 75%, #f57c00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 48px;
            margin-bottom: 15px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: #0288d1;
            font-size: 16px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .welcome-text {
            color: #01579b;
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .interview-structure {
            background: linear-gradient(135deg, #e1f5fe 0%, #f0f7ff 100%);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #b3e5fc;
        }

        .structure-title {
            color: #01579b;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #0277bd, #00897b, #6a1b9a, #d32f2f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rounds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        @media (min-width: 769px) {
            .rounds-grid {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 0;
                padding: 0 20px;
            }

            .round-card {
                flex: 1;
                position: relative;
            }

            .round-card:nth-child(1)::after,
            .round-card:nth-child(2)::after {
                content: '';
                position: absolute;
                top: 50px;
                left: calc(100% + 10px);
                width: calc(100% + 20px);
                height: 3px;
                background: linear-gradient(90deg, #0288d1 0%, #0097a7 100%);
                z-index: 0;
            }
        }

        .round-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            border-left: 4px solid #0288d1;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(67, 160, 212, 0.1);
            border: 1px solid #e0f7ff;
            position: relative;
            z-index: 1;
        }

        .round-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(67, 160, 212, 0.2);
            border-color: #b3e5fc;
        }

        .round-number {
            color: #0277bd;
            font-weight: 700;
            font-size: 12px;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            display: inline-block;
            background: #e1f5fe;
            padding: 4px 12px;
            border-radius: 20px;
        }

        .round-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .round-card:nth-child(1) .round-name {
            color: #0277bd;
        }

        .round-card:nth-child(2) .round-name {
            color: #00897b;
        }

        .round-card:nth-child(3) .round-name {
            color: #6a1b9a;
        }

        .round-description {
            font-size: 14px;
            line-height: 1.5;
        }

        .round-card:nth-child(1) .round-description {
            color: #0277bd;
        }

        .round-card:nth-child(2) .round-description {
            color: #00897b;
        }

        .round-card:nth-child(3) .round-description {
            color: #6a1b9a;
        }

        .form-section {
            margin-top: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #01579b;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input,
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #b3e5fc;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
            background-color: #f5feff;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #0288d1;
            box-shadow: 0 0 0 3px rgba(2, 136, 209, 0.1);
            background-color: white;
        }

        .warning-box {
            background: #e8f4f8;
            border-left: 4px solid #0288d1;
            padding: 15px;
            border-radius: 8px;
            color: #01579b;
            font-size: 14px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0288d1 0%, #0097a7 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 24px rgba(2, 136, 209, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #e1f5fe;
            color: #0277bd;
            border: 2px solid #b3e5fc;
            font-weight: 600;
        }

        .btn-secondary:hover {
            background: #b3e5fc;
            color: #01579b;
        }

        .hidden {
            display: none;
        }

        /* Interview Screen Styles */
        .interview-header {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 0;
            border-bottom: none;
        }

        .interview-header > div:first-child {
            margin-bottom: 10px;
        }

        .round-indicator {
            color: #0277bd;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e1f5fe;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0288d1 0%, #0097a7 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .question-container {
            background: linear-gradient(135deg, #f5feff 0%, #e8f4f8 100%);
            border: 1px solid #b3e5fc;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
        }

        .question-number {
            color: #0277bd;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.7;
            background: linear-gradient(90deg, #0277bd, #00897b, #6a1b9a, #d32f2f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #b3e5fc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #f5feff;
        }

        .radio-option:hover {
            border-color: #0288d1;
            background: #e1f5fe;
        }

        .radio-option input[type="radio"] {
            margin-right: 15px;
            cursor: pointer;
            width: auto;
            border: none;
        }

        .radio-option input[type="radio"]:checked + label {
            color: #0277bd;
        }

        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
            flex: 1;
        }

        .radio-option input[type="radio"]:checked {
            accent-color: #0288d1;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #b3e5fc;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 150px;
            transition: all 0.3s ease;
            background-color: white;
        }

        textarea:focus {
            outline: none;
            border-color: #0288d1;
            box-shadow: 0 0 0 3px rgba(2, 136, 209, 0.1);
            background-color: white;
        }

        .results-section {
            text-align: center;
        }

        .results-title {
            color: #0288d1;
            font-size: 48px;
            margin-bottom: 10px;
        }

        .results-subtitle {
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #0277bd 0%, #00897b 25%, #6a1b9a 50%, #d32f2f 75%, #f57c00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .results-message {
            color: #0288d1;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .results-details {
            background: linear-gradient(135deg, #e1f5fe 0%, #f0f7ff 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: left;
            border: 1px solid #b3e5fc;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #b3e5fc;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
        }

        .detail-row:nth-child(1) .detail-label {
            color: #0277bd;
        }

        .detail-row:nth-child(2) .detail-label {
            color: #00897b;
        }

        .detail-row:nth-child(3) .detail-label {
            color: #6a1b9a;
        }

        .detail-row:nth-child(4) .detail-label {
            color: #d32f2f;
        }

        .detail-value {
            font-weight: 700;
        }

        .detail-row:nth-child(1) .detail-value {
            color: #0277bd;
        }

        .detail-row:nth-child(2) .detail-value {
            color: #00897b;
        }

        .detail-row:nth-child(3) .detail-value {
            color: #6a1b9a;
        }

        .detail-row:nth-child(4) .detail-value {
            color: #d32f2f;
        }

        .score-box {
            background: linear-gradient(135deg, #0288d1 0%, #0097a7 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 8px 24px rgba(2, 136, 209, 0.25);
        }

        .score-label {
            font-size: 14px;
            font-weight: 600;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .score-value {
            font-size: 56px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .score-max {
            font-size: 14px;
            opacity: 0.85;
        }

        .instructions-section {
            text-align: center;
        }

        .greeting {
            color: #0277bd;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .greeting-subtitle {
            color: #0288d1;
            font-size: 16px;
            margin-bottom: 30px;
            font-weight: 500;
        }

        .instructions-box {
            background: linear-gradient(135deg, #e1f5fe 0%, #f0f7ff 100%);
            border: 1px solid #b3e5fc;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: left;
        }

        .instructions-title {
            color: #01579b;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #0277bd, #00897b, #6a1b9a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .instruction-item {
            color: #01579b;
            font-size: 14px;
            line-height: 1.8;
            margin-bottom: 12px;
            padding-left: 20px;
            position: relative;
        }

        .instruction-item:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #0288d1;
            font-weight: bold;
        }

        .instruction-item:last-child {
            margin-bottom: 0;
        }

        .agreement-box {
            background: #f5feff;
            border: 2px solid #b3e5fc;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }

        .checkbox-container {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: #0288d1;
            flex-shrink: 0;
        }

        .checkbox-label {
            color: #01579b;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            line-height: 1.5;
        }

        .animated-girl {
            font-size: 80px;
            display: inline-block;
            animation: wave 2s ease-in-out infinite, float 3s ease-in-out infinite;
            transform-origin: 70% 70%;
        }

        @keyframes wave {
            0%, 100% {
                transform: rotate(0deg);
            }
            25% {
                transform: rotate(20deg);
            }
            75% {
                transform: rotate(-20deg);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @media (max-width: 768px) {
            .card {
                padding: 30px;
            }

            h1 {
                font-size: 28px;
            }

            .rounds-grid {
                grid-template-columns: 1fr;
            }

            .round-card:nth-child(-n+2)::after {
                content: '';
                position: absolute;
                top: 100%;
                left: 50%;
                width: 3px;
                height: 20px;
                background: linear-gradient(180deg, #0288d1 0%, #0097a7 100%);
                transform: translateX(-50%);
                z-index: 0;
            }

            .button-group {
                flex-direction: column;
            }

            .interview-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .question-container {
                padding: 20px;
                min-height: 250px;
            }

            .question-text {
                font-size: 18px;
            }

            #roundTitle {
                font-size: 24px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <!-- Landing Screen -->
            <div id="landingScreen">
                <div class="header">
                    <div class="logo"></div>
                    <h1>Mira</h1>
                    <p class="subtitle">AI Interview Assessment Platform</p>
                </div>

                <p class="welcome-text">
                    Welcome to our structured interview process. This interview consists of three rounds: Screening, Technical Assessment, and Scenario-Based Problem Solving.
                </p>

                <div class="interview-structure">
                    <div class="structure-title">Interview Structure</div>
                    <div class="rounds-grid">
                        <div class="round-card">
                            <div class="round-number">ROUND 1</div>
                            <div class="round-name">Screening</div>
                            <div class="round-description">Background and motivation assessment</div>
                        </div>
                        <div class="round-card">
                            <div class="round-number">ROUND 2</div>
                            <div class="round-name">Technical</div>
                            <div class="round-description">Role-specific knowledge evaluation</div>
                        </div>
                        <div class="round-card">
                            <div class="round-number">ROUND 3</div>
                            <div class="round-name">Scenario</div>
                            <div class="round-description">Real-world problem-solving evaluation</div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="position">Position Applying For</label>
                        <select id="position" required>
                            <option value="">Select Position</option>
                            <option value="Software Engineer">Software Engineer</option>
                            <option value="Product Manager">Product Manager</option>
                            <option value="Data Scientist">Data Scientist</option>
                            <option value="UX Designer">UX Designer</option>
                            <option value="Business Analyst">Business Analyst</option>
                        </select>
                    </div>
                </div>

                <div class="warning-box">
                    ‚ö†Ô∏è Please ensure you have sufficient time to complete the interview without interruptions
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="startInterview()">Begin Interview</button>
                </div>

                <p style="text-align: center; color: #0288d1; font-size: 12px; margin-top: 20px;">Made with ‚ú® by Mira - AI Interview System</p>
            </div>

            <!-- Instructions Screen -->
            <div id="instructionsScreen" class="hidden">
                <div class="instructions-section">
                    <div class="greeting">Welcome, <span id="greetingName">Candidate</span>! üëã</div>
                    <div class="greeting-subtitle">Get ready for your interview with Mira</div>

                    <div class="instructions-box">
                        <div class="instructions-title">Interview Guidelines</div>
                        <div class="instruction-item">Read each question carefully before answering</div>
                        <div class="instruction-item">Provide detailed and thoughtful responses</div>
                        <div class="instruction-item">Take your time - there's no time limit per question</div>
                        <div class="instruction-item">Be honest and authentic in your answers</div>
                        <div class="instruction-item">You can move between rounds, but cannot go back to previous answers</div>
                        <div class="instruction-item">Make sure you have a stable internet connection</div>
                    </div>

                    <div class="instructions-box" style="background: #e8f4f8; border-color: #0288d1;">
                        <div class="instructions-title">What to Expect</div>
                        <div class="instruction-item"><strong>Round 1:</strong> Screening - Tell us about yourself and your motivation</div>
                        <div class="instruction-item"><strong>Round 2:</strong> Technical - Demonstrate your technical knowledge</div>
                        <div class="instruction-item"><strong>Round 3:</strong> Scenario - Solve real-world problems</div>
                    </div>

                    <div class="agreement-box">
                        <div class="checkbox-container">
                            <input type="checkbox" id="agreeCheckbox">
                            <label for="agreeCheckbox" class="checkbox-label">
                                I have read and understood the interview guidelines. I agree to provide honest and thoughtful responses to all questions.
                            </label>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn-secondary" onclick="goBackToLanding()">Back</button>
                        <button class="btn-primary" onclick="startActualInterview()">Start Interview</button>
                    </div>
                </div>
            </div>

            <!-- Interview Screen -->
            <div id="interviewScreen" class="hidden">
                <div class="interview-header">
                    <div>
                        <div class="round-indicator" id="roundIndicator">Round 1 of 3</div>
                        <h2 id="roundTitle" style="color: #01579b; margin-top: 8px; font-weight: 700; font-size: 28px;">Screening Round</h2>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <div id="questionsContainer"></div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="goBackToLanding()" id="backBtn">Back</button>
                    <button class="btn-primary" onclick="nextRound()" id="nextBtn">Next Question</button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="hidden">
                <div class="results-section">
                    <div style="color: #0288d1; font-size: 18px; font-weight: 600; margin-bottom: 20px;">Thank You! üôè</div>
                    <div class="results-title">‚úÖ</div>
                    <div class="results-subtitle">Interview Completed!</div>
                    <div class="results-message" id="finalDecisionMessage">
                      <!-- decision will be injected here -->
                    </div>



                    <div class="results-details">
                        <div class="detail-row">
                            <span class="detail-label">Candidate Name:</span>
                            <span class="detail-value" id="resultName">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Position Applied:</span>
                            <span class="detail-value" id="resultPosition">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Interview Date:</span>
                            <span class="detail-value" id="resultDate">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Total Duration:</span>
                            <span class="detail-value" id="resultDuration">-</span>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn-primary" onclick="restartInterview()">Start New Interview</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
  const API_BASE = "http://127.0.0.1:8000";

  let sessionId = null;
  let currentRoundIndex = 0; // 0=screening,1=technical,2=scenario
  let questions = [];
  let currentQuestionIndex = 0;

  const ROUND_KEYS = ["screening", "technical", "scenario"];

  // Candidate info + timing for your results screen
  const candidate = {
    name: "",
    position: "",
    startTime: null,
    endTime: null,
  };

  // Called by your existing "Begin Interview" button (on landing screen)
  async function startInterview() {
    const fullName = document.getElementById("fullName").value.trim();
    const position = document.getElementById("position").value;

    if (!fullName || !position) {
      alert("Please fill in all required fields");
      return;
    }

    candidate.name = fullName;
    candidate.position = position;
    candidate.startTime = new Date();

    // Create backend session
    const res = await fetch(`${API_BASE}/initialize-interview`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ candidate_name: fullName }),
    });

    const data = await res.json();
    if (!data.session_id) {
      console.error(data);
      alert("Could not start interview. Try again.");
      return;
    }

    sessionId = data.session_id;
    currentRoundIndex = 0;
    currentQuestionIndex = 0;

    // Move to instructions screen
    document.getElementById("landingScreen").classList.add("hidden");
    document.getElementById("instructionsScreen").classList.remove("hidden");
    document.getElementById("greetingName").textContent = fullName;
  }

  // Called by your existing "Start Interview" button on instructions screen
  async function startActualInterview() {
    const agreeCheckbox = document.getElementById("agreeCheckbox");
    if (!agreeCheckbox.checked) {
      alert("Please read and agree to the interview guidelines to continue.");
      return;
    }

    document.getElementById("instructionsScreen").classList.add("hidden");
    document.getElementById("interviewScreen").classList.remove("hidden");

    // Load first round's questions from backend
    await loadQuestionsForCurrentRound();
    renderCurrentQuestion();
  }

  async function loadQuestionsForCurrentRound() {
    const roundKey = ROUND_KEYS[currentRoundIndex]; // screening/technical/scenario

    const res = await fetch(`${API_BASE}/get-questions/${roundKey}`);
    const data = await res.json();

    if (data.error) {
      console.error(data);
      alert("Error loading questions: " + data.error);
      return;
    }

    questions = data.questions || [];
    currentQuestionIndex = 0;
  }

  function renderCurrentQuestion() {
    const questionsContainer = document.getElementById("questionsContainer");
    if (!questionsContainer) return;

    const roundName = ROUND_KEYS[currentRoundIndex];
    const roundLabel =
      roundName.charAt(0).toUpperCase() + roundName.slice(1);
    const totalRounds = ROUND_KEYS.length;
    const totalQuestions = questions.length;

    // Update header
    document.getElementById("roundIndicator").textContent =
      `Round ${currentRoundIndex + 1} of ${totalRounds} - Question ${
        currentQuestionIndex + 1
      } of ${totalQuestions}`;
    document.getElementById("roundTitle").textContent =
      roundLabel + " Round";

    const progressPercentage =
      ((currentRoundIndex * totalQuestions) +
        (currentQuestionIndex + 1)) /
      (totalRounds * totalQuestions) *
      100;
    document.getElementById("progressFill").style.width =
      progressPercentage + "%";

    // Render question
    questionsContainer.innerHTML = "";

    const qText = questions[currentQuestionIndex] || "No question.";
    const section = document.createElement("div");
    section.className = "question-container";

    section.innerHTML = `
      <div class="question-number">
        Question ${currentQuestionIndex + 1} of ${totalQuestions}
      </div>
      <div class="question-text">${qText}</div>
      <textarea id="currentAnswer" placeholder="Type your answer here..." class="question-input"></textarea>
    `;

    questionsContainer.appendChild(section);

    // Update Next button label
    const nextBtn = document.getElementById("nextBtn");
    if (currentQuestionIndex === totalQuestions - 1) {
      nextBtn.textContent =
        currentRoundIndex === ROUND_KEYS.length - 1
          ? "Finish Interview"
          : "Next Round";
    } else {
      nextBtn.textContent = "Next Question";
    }
  }

  // Called by existing "Next Question" button
    async function nextRound() {
  const answerArea = document.getElementById("currentAnswer");
  if (!answerArea || !answerArea.value.trim()) {
    alert("Please answer the question before proceeding.");
    return;
  }

  const roundKey = ROUND_KEYS[currentRoundIndex];

  // 1) Submit answer to backend
  const res = await fetch(`${API_BASE}/submit-answer`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      session_id: sessionId,
      round_name: roundKey,
      question_index: currentQuestionIndex,
      answer: answerArea.value.trim(),
    }),
  });

  const saveData = await res.json();
  if (saveData.error) {
    console.error(saveData);
    alert("Error saving answer: " + saveData.error);
    return;
  }

  const totalQuestions = questions.length;

  // 2) If there are more questions in the same round, just go to next question
  if (currentQuestionIndex < totalQuestions - 1) {
    currentQuestionIndex += 1;
    renderCurrentQuestion();
    return;
  }

  // 3) End of this round: evaluate it
  const evalRes = await fetch(`${API_BASE}/evaluate-round`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      session_id: sessionId,
      round_name: roundKey,
    }),
  });

  const evalData = await evalRes.json();
  if (evalData.error) {
    console.error(evalData);
    alert("Error evaluating round: " + evalData.error);
    return;
  }

  console.log("Round evaluated:", roundKey, evalData);

  // 4) If screening failed, stop here and go to final decision
  if (roundKey === "screening" && !evalData.passed) {
    await completeInterview(); // will call /get-final-decision and show results
    return;
  }

  // 5) Otherwise, continue to next round or finish after last round
  if (currentRoundIndex < ROUND_KEYS.length - 1) {
    currentRoundIndex += 1;
    await loadQuestionsForCurrentRound();
    renderCurrentQuestion();
  } else {
    await completeInterview();
  }
}

    
  async function evaluateCurrentRound() {
    const roundKey = ROUND_KEYS[currentRoundIndex];

    const res = await fetch(`${API_BASE}/evaluate-round`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        session_id: sessionId,
        round_name: roundKey,
      }),
    });

    const data = await res.json();
    if (data.error) {
      console.error(data);
      alert("Error evaluating round: " + data.error);
      return;
    }

    console.log("Round evaluated:", roundKey, data);
  }

    async function completeInterview() {
  candidate.endTime = new Date();

  // Ask backend for final decision + round results
  const res = await fetch(`${API_BASE}/get-final-decision`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ session_id: sessionId }),
  });

  const data = await res.json();
  if (data.error) {
    console.error(data);
    alert("Error getting final decision: " + data.error);
    return;
  }

  // Switch screens
  document.getElementById("interviewScreen").classList.add("hidden");
  document.getElementById("resultsScreen").classList.remove("hidden");

  // Candidate info
  document.getElementById("resultName").textContent = candidate.name;
  document.getElementById("resultPosition").textContent = candidate.position;
  document.getElementById("resultDate").textContent =
    new Date().toLocaleDateString();
  document.getElementById("resultDuration").textContent =
    calculateDuration(candidate.startTime, candidate.endTime);

  // Show final decision from backend
  const decisionEl = document.getElementById("finalDecisionMessage");
  if (decisionEl) {
    decisionEl.textContent =
      data.final_decision || "Decision not available.";
  }

  console.log("Final decision:", data.final_decision, data);
}



  function calculateDuration(startTime, endTime) {
    const diff = endTime - startTime;
    const minutes = Math.floor(diff / 60000);
    const seconds = Math.floor((diff % 60000) / 1000);
    return `${minutes}m ${seconds}s`;
  }

  function goBackToLanding() {
    if (
      confirm(
        "Are you sure you want to go back? Your progress will be lost."
      )
    ) {
      document.getElementById("interviewScreen").classList.add("hidden");
      document.getElementById("instructionsScreen").classList.add("hidden");
      document.getElementById("resultsScreen").classList.add("hidden");
      document.getElementById("landingScreen").classList.remove("hidden");
      document.getElementById("fullName").value = "";
      document.getElementById("position").value = "";
      sessionId = null;
      currentRoundIndex = 0;
      currentQuestionIndex = 0;
      questions = [];
    }
  }

  function restartInterview() {
    document.getElementById("resultsScreen").classList.add("hidden");
    document.getElementById("landingScreen").classList.remove("hidden");
    document.getElementById("fullName").value = "";
    document.getElementById("position").value = "";
    sessionId = null;
    currentRoundIndex = 0;
    currentQuestionIndex = 0;
    questions = [];
  }

</script>

</body>
</html>
